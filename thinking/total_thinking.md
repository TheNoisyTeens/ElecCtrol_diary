## 代码编写思路梳理
>以英雄机器人为例
### 1. LED灯闪烁任务
>比如LED500ms闪烁一次，如果某个任务卡死，灯就灭了

说明：
上电，如果程序正常执行一定要让一个灯在闪烁，一旦发现灯闪烁频率出现问题或灯不闪了，说明程序出现问题了。

---

### 2. 检测任务
>自动检测哪个地方导线坏，然后比如蜂鸣器不同的响声代表不同的状态，也可以用LED灯来提示。
>我们给每个电机分配一个灯，遥控器也分配一个灯。哪一个不好使相应的灯就灭

思路：
我们的所有电机都有反馈，反馈怎么写中断写的，  
长时间未进入中断说明这个东西有问题  

>**以遥控器为例**
>遥控器，串口中断。我们写一个定时器中断，100ms，把一个标志位置为1，并在遥控器串口中断置为0(因为遥控器一直有数据，所以标志位一直为0)。
>
>那么，100ms标志位 置1后立刻又被置为0。如果遥控器数据断了，隔100ms标志位置1后再也不会置0。
>
>然后我们去判断,如果标志位 为1的时间达到了1s，说明遥控器数据断了，这时我们可以让1号LED灭

#### 看门狗
它会隔一段时间把一个标志位置1
在我们程序中，如果程序正常运行，我们在主函数while循环里不断地把这个标志位置0
看门狗隔一段时间将标志位置1，在while循环里不断将标志位置0
忽然卡死在某一个程序中就不会再重新置0了，再过一段时间，看门狗发现这个标志位不是0了，叫做没有"**喂狗**"。如果一段时间没有喂狗（它认为我们的程序进入异常状态），那么它就自动将程序复位重启

**弊端**：不知道程序哪个地方出问题了

---
### 3. 校准任务




### 4. 底盘任务
>先写一段只需要执行一次的（即初始化操作）
然后在while循环里实现功能

>底盘电机用CAN总线

* 接收遥控器数据，并解析
* CAN发送
>CAN有个发送电流值的函数
* 麦伦解算
>通过遥控器拨杆控制不同转向

>问题：
>*  斜向平移
>* 既要斜向平移，又要转

* PID
>电机必然要闭环。那就需要CAN总线反馈，即CAN接收
 
 #### 电机功率不能超过60w，否则扣血
 所以，要读取底盘的功率和能量，转化出底盘的最大速度，当我们速度超了的时候，我们要给它降速

#### 比赛时，使用键盘控制
但是键盘只有"0"和"1"，必然超功率，所以还要对按键进行处理

#### 加上云台
**底盘跟随**：云台转动一个角度，底盘自己跟过来
——————————
1. 延时200ms（规范）

目的：防止程序初始化还未执行完

2. 底盘初始化 `chassis_Init()`


在底盘初始化函数中，初始化一个**遥控器结构体指针**，<font color='green'>然后在中断函数中对指针指向的内存赋值，那么只要在while循环里利用指针使用这块内存数据即可 </font>
>否则，每次都需要在while循环里得到遥控器数据，再使用（更麻烦）

同理，**电机反馈值** 也可用结构体指针，然后初始化它，使用的时候传地址

3. 在while循环中

（1）进行PID，麦伦解算，CAN发送（电流值）
（2）`set_Mode()`设置模式
><font color='green'>在这个函数里用if判断，只是设置这个模式。每个模式怎么做写在另一个函数里 </font>。

#### s1、s2通道 —— **模式选择**：
* **正常模式**
* **子模式**

在正常模式下追加模式
>比如：
>**补弹模式**，需要对最大速度进行限制
>**敌见掉头模式**，方便逃跑（云台转180°，然后底盘跟随）
>**扭腰模式**(对于底盘)，在小陀螺（可转360°）还没出来前，躲避子弹的方式就叫扭腰
>**上坡模式**，可能将两个轮的速度降下来，将两个轮的速度提上去，可能会更加平稳。放一个陀螺仪，当发现倾角大于一个值时，说明它在坡上，对轮子进行相应的操作
>······
* **无力模式**

方便调试

（3）模式切换函数
当模式变换时，需要进行的操作
>从一个模式切换到另一个模式需要模式的过渡，有时候需要对云台、底盘做一个变动，不可能"咔"一变就直接切换到另一个模式

（4）引入遥控器数据
将遥控器值和鼠标键盘值加到一起
>比如控制上下：'W'、'S'、ch0的值加到一起


---
### 5. 云台任务





---
### 6. 发射任务






---
###  7. MPU（陀螺仪）任务
>以后学
>很难写，没有必要去自己写

陀螺仪知道角度和角速度

但是，陀螺仪存在漂移，它的角度是通过积分来得到
>积分（即加和），那么就会积累之前的误差，就会导致越算越算不准，

如果不校准或校准不好的话，就会发现陀螺仪漂移
>陀螺仪**漂移**（还不理解）：
>数据自动改变的情况

那么就需要进行校准，就相当于得到三个参数，我们每次写程序时 陀螺仪都会引入这三个参数，将误差抵消。
但是，这三个参数手动输入不现实
>手动输入很麻烦，
>。首先，我们要通过仿真得到这三个数，然后填入。下一次再得到这三个数，还要通过仿真，然后再将这三个数填入。

-->**校准任务**
校准陀螺仪：
我们遥控器拨杆先内八再外八，然后就执行遥控器校准任务

它会先校准一段时间，校准完就得到这三个参数，它会存到STM32的flash中，
然后我们每次从flash中去得到这三个数就好
>校准原理不需要知道，大疆给的代码，我们用就好了，把它理解为库函数就好（校准陀螺仪：得到这三个参数，并把这三个参数存入flash中）
>**flash**：
>以后学
>相当于手机内存卡，存储数据，并且**掉电保护**






---
### 云台上电回正
我们知道正对编码器的值是多少，写个pid就能回正了
>回正：就是，云台的两个电机知道正对时的值，再写个pid让它变回这个值(中间值)（这个值也可以存入flash中）
用到电机编码器

大疆程序：
来了辆新车，我要得到这个中间值，咋得到呢？
我们在车上做了一些机械的限位，它让云台一直往一个方向转直到限位卡死，再往另一个方向转转到限位卡死（yaw、pitch轴）
>* 简单理解yaw轴、pitch轴
>[欧拉角pitch、yaw，roll的理解](http://t.csdn.cn/Ae1Uf)
>[机器人的坐标体系RPY：roll轴、pitch轴和yaw轴](http://t.csdn.cn/0BqzX)

但是，我们步兵使用小陀螺，英雄使用大陀螺：
就不可能有机械限位（我们需要360°旋转），就只能上电通过仿真测试


---
>我们可以不用自己写程序，去找代码，然后去看懂，变成我们自己的。
>STM32外设用到一个学一个
>初学看原子，修炼看野火
